function $(id){if(typeof id=="string"){return document.getElementById(id)}else{return id}}function clone(_2){var _3={};for(property in _2){_3[property]=_2[property]}return _3}function insertElement(_4,_5,id,_7,_8){var el=document.createElement(_5);if(id){el.id=id}if(_7){el.className=_7}if(_8){insertText(el,_8)}if(_4){_4.appendChild(el)}return el}function insertText(_a,_b){return _a.appendChild(document.createTextNode(_b))}function removeChildren(el){while(el.hasChildNodes()){el.removeChild(el.firstChild)}}function setPageElement(id,_e,_f){if(place=$(id)){removeChildren(place);if(tale.has(_e)){new Wikifier(place,tale.get(_e).text)}else{new Wikifier(place,_f)}}}function addStyle(_10){if(document.createStyleSheet){document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style>"+_10+"</style>")}else{var el=document.createElement("style");el.type="text/css";el.appendChild(document.createTextNode(_10));document.getElementsByTagName("head")[0].appendChild(el)}}function throwError(_12,_13){new Wikifier(_12,"'' @@ "+_13+" @@ ''")}Math.easeInOut=function(i){return(1-((Math.cos(i*Math.PI)+1)/2))};String.prototype.readMacroParams=function(){var _15=new RegExp("(?:\\s*)(?:(?:\"([^\"]*)\")|(?:'([^']*)')|(?:\\[\\[([^\\]]*)\\]\\])|([^\"'\\s]\\S*))","mg");var _16=[];do{var _17=_15.exec(this);if(_17){if(_17[1]){_16.push(_17[1])}else{if(_17[2]){_16.push(_17[2])}else{if(_17[3]){_16.push(_17[3])}else{if(_17[4]){_16.push(_17[4])}}}}}}while(_17);return _16};String.prototype.readBracketedList=function(){var _18="\\[\\[([^\\]]+)\\]\\]";var _19="[^\\s$]+";var _1a="(?:"+_18+")|("+_19+")";var re=new RegExp(_1a,"mg");var _1c=[];do{var _1d=re.exec(this);if(_1d){if(_1d[1]){_1c.push(_1d[1])}else{if(_1d[2]){_1c.push(_1d[2])}}}}while(_1d);return(_1c)};String.prototype.trim=function(){var _1e=new RegExp("^\\s*(.*?)\\s*$","mg");return(this.replace(_1e,"$1"))};function fade(el,_20){var _21;var _22=el.cloneNode(true);var _23=(_20.fade=="in")?1:-1;el.parentNode.replaceChild(_22,el);if(_20.fade=="in"){_21=0;_22.style.visibility="visible"}else{_21=1}setOpacity(_22,_21);var _24=window.setInterval(tick,25);function tick(){_21+=0.05*_23;setOpacity(_22,Math.easeInOut(_21));if(((_23==1)&&(_21>=1))||((_23==-1)&&(_21<=0))){el.style.visibility=(_20.fade=="in")?"visible":"hidden";_22.parentNode.replaceChild(el,_22);delete _22;window.clearInterval(_24);if(_20.onComplete){_20.onComplete()}}}function setOpacity(el,_26){var _27=Math.floor(_26*100);el.style.zoom=1;el.style.filter="alpha(opacity="+_27+")";el.style.opacity=_26}}function scrollWindowTo(el){var _29=window.scrollY?window.scrollY:document.body.scrollTop;var end=ensureVisible(el);var _2b=Math.abs(_29-end);var _2c=0;var _2d=(_29>end)?-1:1;var _2e=window.setInterval(tick,25);function tick(){_2c+=0.1;window.scrollTo(0,_29+_2d*(_2b*Math.easeInOut(_2c)));if(_2c>=1){window.clearInterval(_2e)}}function ensureVisible(el){var _30=findPosY(el);var _31=_30+el.offsetHeight;var _32=window.scrollY?window.scrollY:document.body.scrollTop;var _33=window.innerHeight?window.innerHeight:document.body.clientHeight;var _34=_32+_33;if(_30<_32){return _30}else{if(_31>_34){if(el.offsetHeight<_33){return(_30-(_33-el.offsetHeight)+20)}else{return _30}}else{return _30}}}function findPosY(el){var _36=0;while(el.offsetParent){_36+=el.offsetTop;el=el.offsetParent}return _36}}function History(){this.history=[{passage:null,variables:{}}]}History.prototype.init=function(){if(!this.restore()){if(tale.has("StartPassages")){var _37=tale.get("StartPassages").text.readBracketedList();for(var i=0;i<_37.length;i++){this.display(_37[i],null,"quietly")}}else{this.display("Start",null,"quietly")}}};History.prototype.close=function(_39){var el=$("passage"+_39.title);if(el){el.parentNode.removeChild(el)}};History.prototype.display=function(_3b,_3c,_3d){var _3e=_3c;while(_3e&&(_3e.className.indexOf("passage")==-1)){if(_3e.parentNode.className){_3e=_3e.parentNode}else{break}}if(el=$("passage"+_3b)){scrollWindowTo(el);return}var _3f=tale.get(_3b);this.history.unshift({passage:_3f,variables:clone(this.history[0].variables)});var div=_3f.render();if(_3d!="offscreen"){if(_3e){$("passages").insertBefore(div,_3e.nextSibling)}else{$("passages").appendChild(div)}if(_3d!="quietly"){scrollWindowTo(div);fade(div,{fade:"in"})}}if((_3d=="quietly")||(_3d=="offscreen")){div.style.visibility="visible"}return div};History.prototype.restart=function(){window.location.hash=""};History.prototype.save=function(_41){var _42="";for(var i=0;i<this.history.length;i++){if((this.history[i].passage)&&(this.history[i].passage.id)){_42+=this.history[i].passage.id.toString(36)+".";if(this.history[i].passage.id==_41.id){break}}}return"#"+_42.substr(0,_42.length-1)};History.prototype.restore=function(){try{if(window.location.hash==""){return false}var _44=window.location.hash.replace("#","").split(".");var _45=[];for(var i=_44.length-1;i>=0;i--){var id=parseInt(_44[i],36);if(!tale.has(id)){return false}_45.unshift(this.display(id,null,"offscreen"))}$("passages").appendChild(_45[0]);return true}catch(e){return false}};History.prototype.rewindTo=function(_48){var _49=this;fade($("passages"),{fade:"out",onComplete:work});function work(){while(_49.history[0].passage.title!=_48.title){_49.close(_49.history.shift().passage)}_49.history[0].variables=clone(_49.history[1].variables);_48.reset();var els=$("passage"+_48.title).childNodes;for(var i=0;i<els.length;i++){if(els[i].className=="body"){removeChildren(els[i]);new Wikifier(els[i],_48.text)}}fade($("passages"),{fade:"in"})}};var version={major:2,minor:0,revision:0,date:new Date("July 30, 2007"),extensions:{}};var tale,state;var macros={};function main(){tale=new Tale();setPageElement("storyMenu","StoryMenu","");setPageElement("storyTitle","StoryTitle","Untitled Story");setPageElement("storySubtitle","StorySubtitle","");setPageElement("storyAuthor","StoryAuthor","");if(tale.has("StoryTitle")){document.title=tale.get("StoryTitle").text;if(tale.has("StorySubtitle")){document.title+=": "+tale.get("StorySubtitle").text}}for(macro in macros){if(typeof macro.init=="function"){macro.init()}}var _4c=tale.lookup("tags","stylesheet");for(var i=0;i<_4c.length;i++){addStyle(_4c[i].text)}var _4e=tale.lookup("tags","script");for(var i=0;i<_4e.length;i++){try{eval(_4e[i].text)}catch(e){alert("There is a technical problem with this story ("+_4e[i].title+": "+e.message+"). You may be able "+"to continue reading, but all parts of the story may not "+"work properly.")}}state=new History();state.init()}version.extensions.choiceMacro={major:1,minor:2,revision:0};macros["choice"]={handler:function(_4f,_50,_51){var _52=document.createElement("a");_52.href="javascript:void(0)";_52.className="internalLink choice";if(_51[1]){_52.innerHTML=_51[1]}else{_52.innerHTML=_51[0]}_52.onclick=function(){macros["choice"].activate(_52,_51[0])};_4f.appendChild(_52)},activate:function(el,_54){var _55=el.parentNode;while(_55.className.indexOf("body")==-1){_55=_55.parentNode}var _56=_55.parentNode.id.substr(7);var _57=_55.getElementsByTagName("a");var _58=[];for(var i=0;i<_57.length;i++){if((_57[i]!=el)&&(_57[i].className.indexOf("choice")!=-1)){var _5a=document.createElement("span");_5a.innerHTML=_57[i].innerHTML;_5a.className="disabled";_57[i].parentNode.insertBefore(_5a,_57[i].nextSibling);_58.push(_57[i])}}for(var i=0;i<_58.length;i++){_58[i].parentNode.removeChild(_58[i])}tale.get(_56).text="<html>"+_55.childNodes[0].innerHTML+"</html>";state.display(_54,el)}};version.extensions.displayMacro={major:1,minor:0,revision:0};macros["display"]={handler:function(_5b,_5c,_5d){new Wikifier(_5b,tale.get(_5d[0]).text)}};version.extensions.actionsMacro={major:1,minor:0,revision:0};macros["actions"]={clicked:new Object(),handler:function(_5e,_5f,_60){var _61=document.createElement("ul");for(var i=0;i<_60.length;i++){if(macros["actions"].clicked[_60[i]]){continue}var _63=document.createElement("li");macros["choice"].handler(_63,"choice",[_60[i]]);var _64=_63.getElementsByTagName("a")[0];_64.onclick=function(){macros["actions"].clicked[this.innerHTML]=true;macros["choice"].activate(this,this.innerHTML)};_61.appendChild(_63)}_5e.appendChild(_61)}};version.extensions.printMacro={major:1,minor:1,revision:0};macros["print"]={handler:function(_65,_66,_67,_68){try{var _69=eval(_68.fullArgs());if(_69){new Wikifier(_65,_69.toString())}}catch(e){throwError(_65,"bad expression: "+e.message)}}};version.extensions.setMacro={major:1,minor:1,revision:0};macros["set"]={handler:function(_6a,_6b,_6c,_6d){macros["set"].run(_6d.fullArgs())},run:function(_6e){try{return eval(Wikifier.parse(_6e))}catch(e){throwError(place,"bad expression: "+e.message)}}};version.extensions["ifMacros"]={major:1,minor:0,revision:0};macros["if"]={handler:function(_6f,_70,_71,_72){var _73=_72.fullArgs();var _74=_72.source.indexOf(">>",_72.matchStart)+2;var src=_72.source.slice(_74);var _76=-1;var _77="";var _78="";for(var i=0,nesting=1,currentClause=true;i<src.length;i++){if(src.substr(i,9)=="<<endif>>"){nesting--;if(nesting==0){_76=_74+i+9;break}}if((src.substr(i,8)=="<<else>>")&&(nesting==1)){currentClause="false";i+=8}if(src.substr(i,5)=="<<if "){nesting++}if(currentClause==true){_77+=src.charAt(i)}else{_78+=src.charAt(i)}}try{if(eval(_73)){new Wikifier(_6f,_77.trim())}else{new Wikifier(_6f,_78.trim())}if(_76!=-1){_72.nextMatch=_76}else{throwError(_6f,"can't find matching endif")}}catch(e){throwError(_6f,"bad condition: "+e.message)}}};macros["else"]=macros["endif"]={handler:function(){}};version.extensions.rememberMacro={major:1,minor:0,revision:0};macros["remember"]={handler:function(_7a,_7b,_7c,_7d){var _7e=_7d.fullArgs();var _7f=new Date();var _80,value;config.macros["set"].run(_7e);_80=_7e.match(new RegExp(Wikifier.parse("$")+"(\\w+)","i"))[1];value=eval(Wikifier.parse("$"+_80));switch(typeof value){case"string":value="\""+value.replace(/"/g,"\\\"")+"\"";break;case"number":case"boolean":break;default:throwError(_7a,"can't remember $"+_80+" ("+(typeof value)+")");return}_7f.setYear(_7f.getFullYear()+1);document.cookie=macros["remember"].prefix+_80+"="+value+"; expires="+_7f.toGMTString()},init:function(){if(tale.has("StoryTitle")){macros["remember"].prefix=tale.get("StoryTitle").text+"_"}else{macros["remember"].prefix="__jonah_"}var _81=document.cookie.split(";");for(var i=0;i<_81.length;i++){var _83=_81[i].split("=");if(_83[0].trim().indexOf(this.prefix)==0){var _84=_81[i].replace(this.prefix,"$");eval(Wikifier.parse(_84))}}}};version.extensions["SilentlyMacro"]={major:1,minor:0,revision:0};macros["silently"]={handler:function(_85,_86,_87,_88){var _89=insertElement(null,"div");var _8a=_88.source.indexOf(">>",_88.matchStart)+2;var src=_88.source.slice(_8a);var _8c=-1;var _8d="";for(var i=0;i<src.length;i++){if(src.substr(i,15)=="<<endsilently>>"){_8c=_8a+i+15}else{_8d+=src.charAt(i)}}if(_8c!=-1){new Wikifier(_89,_8d);_88.nextMatch=_8c}else{throwError(_85,"can't find matching endsilently")}delete _89}};macros["endsilently"]={handler:function(){}};function Passage(_8f,el,_91){this.title=_8f;if(el){this.id=_91;this.initialText=this.text=Passage.unescapeLineBreaks(el.firstChild?el.firstChild.nodeValue:"");this.tags=el.getAttribute("tags");if(typeof this.tags=="string"){this.tags=this.tags.readBracketedList()}else{this.tags=[]}}else{this.initialText=this.text="@@This passage does not exist.@@";this.tags=[]}}Passage.prototype.render=function(){var _92=insertElement(null,"div","passage"+this.title,"passage");_92.style.visibility="hidden";var _93=insertElement(_92,"div","","toolbar");for(var i=0;i<Passage.toolbarItems.length;i++){var _95=insertElement(_93,"a");insertText(_95,Passage.toolbarItems[i].label(_92));_95.passage=this;if(Passage.toolbarItems[i].href){_95.href=Passage.toolbarItems[i].href(_92)}else{_95.href="javascript:void(0)"}_95.title=Passage.toolbarItems[i].tooltip(_92);_95.onclick=Passage.toolbarItems[i].activate}insertElement(_92,"div","","title",this.title);var _96=insertElement(_92,"div","","body");new Wikifier(_96,this.text);_92.onmouseover=function(){_92.className+=" selected"};_92.onmouseout=function(){_92.className=_92.className.replace(" selected","")};return _92};Passage.prototype.reset=function(){this.text=this.initialText};Passage.toolbarItems=[{label:function(){return"bookmark"},tooltip:function(){return"Bookmark this point in the story"},href:function(_97){return(state.save(_97))},activate:function(){}},{label:function(){return"rewind to here"},tooltip:function(){"Rewind the story to here"},activate:function(){state.rewindTo(this.passage)}}];Passage.unescapeLineBreaks=function(_98){if(_98&&_98!=""){return _98.replace(/\\n/mg,"\n").replace(/\\/mg,"\\").replace(/\r/mg,"")}else{return""}};function Tale(){this.passages={};if(document.normalize){document.normalize()}var _99=$("storeArea").childNodes;for(var i=0;i<_99.length;i++){var el=_99[i];if(el.getAttribute&&(title=el.getAttribute("tiddler"))){this.passages[title]=new Passage(title,el,i)}}}Tale.prototype.has=function(key){if(typeof key=="string"){return(this.passages[key]!=null)}else{for(i in this.passages){if(this.passages[i].id==key){return true}}return false}};Tale.prototype.get=function(key){if(typeof key=="string"){return this.passages[key]||new Passage(key)}else{for(i in this.passages){if(this.passages[i].id==key){return this.passages[i]}}}};Tale.prototype.lookup=function(_9e,_9f,_a0){var _a1=[];for(var t in this.passages){var _a3=this.passages[t];var _a4=false;for(var i=0;i<_a3[_9e].length;i++){if(_a3[_9e][i]==_9f){_a1.push(_a3)}}}if(!_a0){_a0="title"}_a1.sort(function(a,b){if(a[_a0]==b[_a0]){return(0)}else{return(a[_a0]<b[_a0])?-1:+1}});return _a1};Tale.prototype.reset=function(){for(i in this.passages){this.passages[i].reset()}};function Wikifier(_a8,_a9){this.source=_a9;this.output=_a8;this.nextMatch=0;this.assembleFormatterMatches(Wikifier.formatters);this.subWikify(this.output)}Wikifier.prototype.assembleFormatterMatches=function(_aa){this.formatters=[];var _ab=[];for(var n=0;n<_aa.length;n++){_ab.push("("+_aa[n].match+")");this.formatters.push(_aa[n])}this.formatterRegExp=new RegExp(_ab.join("|"),"mg")};Wikifier.prototype.subWikify=function(_ad,_ae){var _af=this.output;this.output=_ad;var _b0=_ae?new RegExp("("+_ae+")","mg"):null;do{this.formatterRegExp.lastIndex=this.nextMatch;if(_b0){_b0.lastIndex=this.nextMatch}var _b1=this.formatterRegExp.exec(this.source);var _b2=_b0?_b0.exec(this.source):null;if(_b2&&(!_b1||_b2.index<=_b1.index)){if(_b2.index>this.nextMatch){this.outputText(this.output,this.nextMatch,_b2.index)}this.matchStart=_b2.index;this.matchLength=_b2[1].length;this.matchText=_b2[1];this.nextMatch=_b2.index+_b2[1].length;this.output=_af;return}else{if(_b1){if(_b1.index>this.nextMatch){this.outputText(this.output,this.nextMatch,_b1.index)}this.matchStart=_b1.index;this.matchLength=_b1[0].length;this.matchText=_b1[0];this.nextMatch=this.formatterRegExp.lastIndex;var _b3=-1;for(var t=1;t<_b1.length;t++){if(_b1[t]){matchingFormatter=t-1}}if(matchingFormatter!=-1){this.formatters[matchingFormatter].handler(this)}}}}while(_b2||_b1);if(this.nextMatch<this.source.length){this.outputText(this.output,this.nextMatch,this.source.length);this.nextMatch=this.source.length}this.output=_af};Wikifier.prototype.outputText=function(_b5,_b6,_b7){insertText(_b5,this.source.substring(_b6,_b7))};Wikifier.prototype.fullArgs=function(){var _b8=this.source.indexOf(" ",this.matchStart);var _b9=this.source.indexOf(">>",this.matchStart);return Wikifier.parse(this.source.slice(_b8,_b9))};Wikifier.parse=function(_ba){var _bb=_ba.replace(/\$/g,"state.history[0].variables.");_bb=_bb.replace(/\beq\b/gi," == ");_bb=_bb.replace(/\bneq\b/gi," != ");_bb=_bb.replace(/\bgt\b/gi," > ");_bb=_bb.replace(/\beq\b/gi," == ");_bb=_bb.replace(/\bneq\b/gi," != ");_bb=_bb.replace(/\bgt\b/gi," > ");_bb=_bb.replace(/\bgte\b/gi," >= ");_bb=_bb.replace(/\blt\b/gi," < ");_bb=_bb.replace(/\blte\b/gi," <= ");_bb=_bb.replace(/\band\b/gi," && ");_bb=_bb.replace(/\bor\b/gi," || ");_bb=_bb.replace(/\bnot\b/gi," ! ");return _bb};Wikifier.formatHelpers={charFormatHelper:function(w){var e=insertElement(w.output,this.element);w.subWikify(e,this.terminator)},inlineCssHelper:function(w){var _bf=[];var _c0="(?:("+Wikifier.textPrimitives.anyLetter+"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:("+Wikifier.textPrimitives.anyLetter+"+):([^;\\|\\n]+);)";var _c1=new RegExp(_c0,"mg");var _c2=false;do{_c1.lastIndex=w.nextMatch;var _c3=_c1.exec(w.source);var _c4=_c3&&_c3.index==w.nextMatch;if(_c4){var s,v;_c2=true;if(_c3[1]){s=_c3[1].unDash();v=_c3[2]}else{s=_c3[3].unDash();v=_c3[4]}switch(s){case"bgcolor":s="backgroundColor";break}_bf.push({style:s,value:v});w.nextMatch=_c3.index+_c3[0].length}}while(_c4);return _bf},monospacedByLineHelper:function(w){var _c7=new RegExp(this.lookahead,"mg");_c7.lastIndex=w.matchStart;var _c8=_c7.exec(w.source);if(_c8&&_c8.index==w.matchStart){var _c9=_c8[1];if(navigator.userAgent.indexOf("msie")!=-1&&navigator.userAgent.indexOf("opera")==-1){_c9=_c9.replace(/\n/g,"\r")}var e=insertElement(w.output,"pre",null,null,_c9);w.nextMatch=_c8.index+_c8[0].length}}};Wikifier.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhc]?)$",lookahead:"^\\|([^\\n]*)\\|([fhc]?)$",rowTerminator:"\\|(?:[fhc]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[fhc]?$\\n?)",cellTerminator:"(?:\\x20*)\\|",rowTypes:{"c":"caption","h":"thead","":"tbody","f":"tfoot"},handler:function(w){var _cc=insertElement(w.output,"table");w.nextMatch=w.matchStart;var _cd=new RegExp(this.lookahead,"mg");var _ce=null,nextRowType;var _cf,rowElement;var _d0=[];var _d1=0;do{_cd.lastIndex=w.nextMatch;var _d2=_cd.exec(w.source);var _d3=_d2&&_d2.index==w.nextMatch;if(_d3){nextRowType=_d2[2];if(nextRowType!=_ce){_cf=insertElement(_cc,this.rowTypes[nextRowType])}_ce=nextRowType;if(_ce=="c"){if(_d1==0){_cf.setAttribute("align","top")}else{_cf.setAttribute("align","bottom")}w.nextMatch=w.nextMatch+1;w.subWikify(_cf,this.rowTerminator)}else{rowElement=insertElement(_cf,"tr");this.rowHandler(w,rowElement,_d0)}_d1++}}while(_d3)},rowHandler:function(w,e,_d6){var col=0;var _d8=1;var _d9=new RegExp(this.cellPattern,"mg");do{_d9.lastIndex=w.nextMatch;var _da=_d9.exec(w.source);matched=_da&&_da.index==w.nextMatch;if(matched){if(_da[1]=="~"){var _db=_d6[col];if(_db){_db.rowCount++;_db.element.setAttribute("rowSpan",_db.rowCount);_db.element.setAttribute("rowspan",_db.rowCount);_db.element.valign="center"}w.nextMatch=_da.index+_da[0].length-1}else{if(_da[1]==">"){_d8++;w.nextMatch=_da.index+_da[0].length-1}else{if(_da[2]){w.nextMatch=_da.index+_da[0].length;break}else{var _dc=false,spaceRight=false;w.nextMatch++;var _dd=Wikifier.formatHelpers.inlineCssHelper(w);while(w.source.substr(w.nextMatch,1)==" "){_dc=true;w.nextMatch++}var _de;if(w.source.substr(w.nextMatch,1)=="!"){_de=insertElement(e,"th");w.nextMatch++}else{_de=insertElement(e,"td")}_d6[col]={rowCount:1,element:_de};lastColCount=1;lastColElement=_de;if(_d8>1){_de.setAttribute("colSpan",_d8);_de.setAttribute("colspan",_d8);_d8=1}for(var t=0;t<_dd.length;t++){_de.style[_dd[t].style]=_dd[t].value}w.subWikify(_de,this.cellTerminator);if(w.matchText.substr(w.matchText.length-2,1)==" "){spaceRight=true}if(_dc&&spaceRight){_de.align="center"}else{if(_dc){_de.align="right"}else{if(spaceRight){_de.align="left"}}}w.nextMatch=w.nextMatch-1}}}col++}}while(matched)}},{name:"rule",match:"^----$\\n?",handler:function(w){insertElement(w.output,"hr")}},{name:"emdash",match:"--",handler:function(w){var e=insertElement(w.output,"span");e.innerHTML="&mdash;"}},{name:"heading",match:"^!{1,5}",terminator:"\\n",handler:function(w){var e=insertElement(w.output,"h"+w.matchLength);w.subWikify(e,this.terminator)}},{name:"monospacedByLine",match:"^\\{\\{\\{\\n",lookahead:"^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"monospacedByLineForPlugin",match:"^//\\{\\{\\{\\n",lookahead:"^//\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^//\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"wikifyCommentForPlugin",match:"^/\\*\\*\\*\\n",terminator:"^\\*\\*\\*/\\n",handler:function(w){w.subWikify(w.output,this.terminator)}},{name:"quoteByBlock",match:"^<<<\\n",terminator:"^<<<\\n",handler:function(w){var e=insertElement(w.output,"blockquote");w.subWikify(e,this.terminator)}},{name:"quoteByLine",match:"^>+",terminator:"\\n",element:"blockquote",handler:function(w){var _e9=new RegExp(this.match,"mg");var _ea=[w.output];var _eb=0;var _ec=w.matchLength;var t;do{if(_ec>_eb){for(t=_eb;t<_ec;t++){_ea.push(insertElement(_ea[_ea.length-1],this.element))}}else{if(_ec<_eb){for(t=_eb;t>_ec;t--){_ea.pop()}}}_eb=_ec;w.subWikify(_ea[_ea.length-1],this.terminator);insertElement(_ea[_ea.length-1],"br");_e9.lastIndex=w.nextMatch;var _ee=_e9.exec(w.source);var _ef=_ee&&_ee.index==w.nextMatch;if(_ef){_ec=_ee[0].length;w.nextMatch+=_ee[0].length}}while(_ef)}},{name:"list",match:"^(?:(?:\\*+)|(?:#+))",lookahead:"^(?:(\\*+)|(#+))",terminator:"\\n",outerElement:"ul",itemElement:"li",handler:function(w){var _f1=new RegExp(this.lookahead,"mg");w.nextMatch=w.matchStart;var _f2=[w.output];var _f3=null,newType;var _f4=0,newLevel;var t;do{_f1.lastIndex=w.nextMatch;var _f6=_f1.exec(w.source);var _f7=_f6&&_f6.index==w.nextMatch;if(_f7){if(_f6[1]){newType="ul"}if(_f6[2]){newType="ol"}newLevel=_f6[0].length;w.nextMatch+=_f6[0].length;if(newLevel>_f4){for(t=_f4;t<newLevel;t++){_f2.push(insertElement(_f2[_f2.length-1],newType))}}else{if(newLevel<_f4){for(t=_f4;t>newLevel;t--){_f2.pop()}}else{if(newLevel==_f4&&newType!=_f3){_f2.pop();_f2.push(insertElement(_f2[_f2.length-1],newType))}}}_f4=newLevel;_f3=newType;var e=insertElement(_f2[_f2.length-1],"li");w.subWikify(e,this.terminator)}}while(_f7)}},{name:"prettyLink",match:"\\[\\[",lookahead:"\\[\\[([^\\|\\]]*?)(?:(\\]\\])|(\\|(.*?)\\]\\]))",terminator:"\\|",handler:function(w){var _fa=new RegExp(this.lookahead,"mg");_fa.lastIndex=w.matchStart;var _fb=_fa.exec(w.source);if(_fb&&_fb.index==w.matchStart&&_fb[2]){var _fc=Wikifier.createInternalLink(w.output,_fb[1]);w.outputText(_fc,w.nextMatch,w.nextMatch+_fb[1].length);w.nextMatch+=_fb[1].length+2}else{if(_fb&&_fb.index==w.matchStart&&_fb[3]){var e;if(tale.has(_fb[4])){e=Wikifier.createInternalLink(w.output,_fb[4])}else{e=Wikifier.createExternalLink(w.output,_fb[4])}w.outputText(e,w.nextMatch,w.nextMatch+_fb[1].length);w.nextMatch=_fb.index+_fb[0].length}}}},{name:"urlLink",match:"(?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b)",handler:function(w){var e=Wikifier.createExternalLink(w.output,w.matchText);w.outputText(e,w.matchStart,w.nextMatch)}},{name:"image",match:"\\[(?:[<]{0,1})(?:[>]{0,1})[Ii][Mm][Gg]\\[",lookahead:"\\[([<]{0,1})([>]{0,1})[Ii][Mm][Gg]\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\]?)?(\\])",handler:function(w){var _101=new RegExp(this.lookahead,"mg");_101.lastIndex=w.matchStart;var _102=_101.exec(w.source);if(_102&&_102.index==w.matchStart){var e=w.output;if(_102[5]){if(tale.has(_102[5])){e=Wikifier.createInternalLink(w.output,_102[5])}else{e=Wikifier.createExternalLink(w.output,_102[5])}}var img=insertElement(e,"img");if(_102[1]){img.align="left"}else{if(_102[2]){img.align="right"}}if(_102[3]){img.title=_102[3]}img.src=_102[4];w.nextMatch=_102.index+_102[0].length}}},{name:"macro",match:"<<",lookahead:"<<([^>\\s]+)(?:\\s*)([^>]*)>>",handler:function(w){var _106=new RegExp(this.lookahead,"mg");_106.lastIndex=w.matchStart;var _107=_106.exec(w.source);if(_107&&_107.index==w.matchStart&&_107[1]){var _108=_107[2].readMacroParams();w.nextMatch=_107.index+_107[0].length;try{var _109=macros[_107[1]];if(_109&&_109.handler){_109.handler(w.output,_107[1],_108,w)}else{insertElement(w.output,"span",null,"marked","macro not found: "+_107[1])}}catch(e){throwError(w.output,"Error executing macro "+_107[1]+": "+e.toString())}}}},{name:"html",match:"<[Hh][Tt][Mm][Ll]>",lookahead:"<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)</[Hh][Tt][Mm][Ll]>",handler:function(w){var _10b=new RegExp(this.lookahead,"mg");_10b.lastIndex=w.matchStart;var _10c=_10b.exec(w.source);if(_10c&&_10c.index==w.matchStart){var e=insertElement(w.output,"span");e.innerHTML=_10c[1];w.nextMatch=_10c.index+_10c[0].length}}},{name:"commentByBlock",match:"/%",lookahead:"/%((?:.|\\n)*?)%/",handler:function(w){var _10f=new RegExp(this.lookahead,"mg");_10f.lastIndex=w.matchStart;var _110=_10f.exec(w.source);if(_110&&_110.index==w.matchStart){w.nextMatch=_110.index+_110[0].length}}},{name:"boldByChar",match:"''",terminator:"''",element:"strong",handler:Wikifier.formatHelpers.charFormatHelper},{name:"strikeByChar",match:"==",terminator:"==",element:"strike",handler:Wikifier.formatHelpers.charFormatHelper},{name:"underlineByChar",match:"__",terminator:"__",element:"u",handler:Wikifier.formatHelpers.charFormatHelper},{name:"italicByChar",match:"//",terminator:"//",element:"em",handler:Wikifier.formatHelpers.charFormatHelper},{name:"subscriptByChar",match:"~~",terminator:"~~",element:"sub",handler:Wikifier.formatHelpers.charFormatHelper},{name:"superscriptByChar",match:"\\^\\^",terminator:"\\^\\^",element:"sup",handler:Wikifier.formatHelpers.charFormatHelper},{name:"monospacedByChar",match:"\\{\\{\\{",lookahead:"\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",handler:function(w){var _112=new RegExp(this.lookahead,"mg");_112.lastIndex=w.matchStart;var _113=_112.exec(w.source);if(_113&&_113.index==w.matchStart){var e=insertElement(w.output,"code",null,null,_113[1]);w.nextMatch=_113.index+_113[0].length}}},{name:"styleByChar",match:"@@",terminator:"@@",lookahead:"(?:([^\\(@]+)\\(([^\\)]+)(?:\\):))|(?:([^:@]+):([^;]+);)",handler:function(w){var e=insertElement(w.output,"span",null,null,null);var _117=Wikifier.formatHelpers.inlineCssHelper(w);if(_117.length==0){e.className="marked"}else{for(var t=0;t<_117.length;t++){e.style[_117[t].style]=_117[t].value}}w.subWikify(e,this.terminator)}},{name:"lineBreak",match:"\\n",handler:function(w){insertElement(w.output,"br")}}];Wikifier.textPrimitives={anyDigit:"[0-9]",anyNumberChar:"[0-9\\.E]",urlPattern:"(?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b)"};Wikifier.createInternalLink=function(_11a,_11b){var el=insertElement(_11a,"a",_11b);el.href="javascript:void(0)";if(tale.has(_11b)){el.className="internalLink"}else{el.className="brokenLink"}el.onclick=function(){state.display(_11b,el)};if(_11a){_11a.appendChild(el)}return el};Wikifier.createExternalLink=function(_11d,url){var el=insertElement(_11d,"a");el.href=url;el.className="externalLink";el.target="_blank";if(_11d){_11d.appendChild(el)}return el};if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))){Wikifier.textPrimitives.upperLetter="[A-Z\xc0-\xde]";Wikifier.textPrimitives.lowerLetter="[a-z\xdf-\xff_0-9\\-]";Wikifier.textPrimitives.anyLetter="[A-Za-z\xc0-\xde\xdf-\xff_0-9\\-]"}else{Wikifier.textPrimitives.upperLetter="[A-Z\xc0-\xde\u0150\u0170]";Wikifier.textPrimitives.lowerLetter="[a-z\xdf-\xff_0-9\\-\u0151\u0171]";Wikifier.textPrimitives.anyLetter="[A-Za-z\xc0-\xde\xdf-\xff_0-9\\-\u0150\u0170\u0151\u0171]"}